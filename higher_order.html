


<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="icon" href="">
    
    
      
        <title>Higher-Order Derivatives - XAD Documentation</title>
      
    
    
      <link rel="stylesheet" href="_static/stylesheets/main.b0359c04.min.css">
      
        
        <link rel="stylesheet" href="_static/stylesheets/palette.92c9fe4a.min.css">
        
      
    
    
    
      
        
        
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
        <link rel="stylesheet" type="text/css" href="_static/table_styling.css" />
        <link rel="stylesheet" type="text/css" href="_static/google_fonts.css" />
        <link rel="stylesheet" type="text/css" href="_static/style.css" />
    <script>__md_scope=new URL(".",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      
  


  
  


  <script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-RCTKTZ7HNW"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){this.value&&gtag("event","search",{search_term:this.value})}),"undefined"!=typeof location$&&location$.subscribe(function(e){gtag("config","G-RCTKTZ7HNW",{page_path:e.pathname})})})</script>
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-RCTKTZ7HNW"></script>


    
    



<meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />
<meta content="Techniques for computing higher order derivatives in the XAD C++ automatic differentiation library." name="description" />

<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/site.webmanifest">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="theme-color" content="#ffffff">
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="grey" data-md-color-accent="amber">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#example-algorithm" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="index.html" title="XAD Documentation" class="md-header__button md-logo" aria-label="XAD Documentation" data-md-component="logo">
      <img src="_static/logo.svg" alt="logo">
    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            XAD Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Higher-Order Derivatives
            
          </span>
        </div>
      </div>
    </div>
    
      <form class="md-header__option" data-md-component="palette">
        
          
          
          <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="grey" data-md-color-accent="amber"  aria-hidden="true"  type="radio" name="__palette" id="__palette_1">
          
        
      </form>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" aria-label="Share" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7 0-.24-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91 1.61 0 2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08Z"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/xcelerit/xad/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    XAD
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="index.html" title="XAD Documentation" class="md-nav__button md-logo" aria-label="XAD Documentation" data-md-component="logo">
      <img src="_static/logo.svg" alt="logo">
    </a>
    XAD Documentation
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/xcelerit/xad/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    XAD
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
  
    <li class="md-nav__item">
      <a href="intro.html" class="md-nav__link">
        <span class="md-ellipsis">Introduction</span>
      </a>
    </li>
  

    
      
      
      

  
  
  
  
    <li class="md-nav__item">
      <a href="aad.html" class="md-nav__link">
        <span class="md-ellipsis">Algorithmic Differentiation Background</span>
      </a>
    </li>
  

    
      
      
      

  
  
  
  
    <li class="md-nav__item">
      <a href="basic.html" class="md-nav__link">
        <span class="md-ellipsis">Basic Usage</span>
      </a>
    </li>
  

    
      
      
      

  
  
  
  
    <li class="md-nav__item">
      <a href="external_functions.html" class="md-nav__link">
        <span class="md-ellipsis">External Functions</span>
      </a>
    </li>
  

    
      
      
      

  
  
  
  
    <li class="md-nav__item">
      <a href="checkpointing.html" class="md-nav__link">
        <span class="md-ellipsis">Checkpointing</span>
      </a>
    </li>
  

    
      
      
      

  
  
    
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          <span class="md-ellipsis">Higher-<wbr>Order Derivatives</span>
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="#" class="md-nav__link md-nav__link--active">
        <span class="md-ellipsis">Higher-<wbr>Order Derivatives</span>
      </a>
      
        

  

<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#example-algorithm" class="md-nav__link">
    <span class="md-ellipsis">Example Algorithm</span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#forward-over-adjoint" class="md-nav__link">
    <span class="md-ellipsis">Forward Over Adjoint</span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#other-second-order-modes" class="md-nav__link">
    <span class="md-ellipsis">Other Second-<wbr>Order Modes</span>
  </a>
  
    <nav class="md-nav" aria-label="Other Second-Order Modes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#forward-over-forward" class="md-nav__link">
    <span class="md-ellipsis">Forward Over Forward</span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#adjoint-over-forward" class="md-nav__link">
    <span class="md-ellipsis">Adjoint Over Forward</span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#adjoint-over-adjoint" class="md-nav__link">
    <span class="md-ellipsis">Adjoint Over Adjoint</span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
      

  
  
  
  
    <li class="md-nav__item">
      <a href="smoothed_math.html" class="md-nav__link">
        <span class="md-ellipsis">Handling Discontinuities</span>
      </a>
    </li>
  

    
      
      
      

  
  
  
  
    <li class="md-nav__item">
      <a href="reference.html" class="md-nav__link">
        <span class="md-ellipsis">Reference</span>
      </a>
    </li>
  

    
      
      
      

  
  
  
  
    <li class="md-nav__item">
      <a href="license.html" class="md-nav__link">
        <span class="md-ellipsis">GNU Free Documentation License</span>
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  

<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#example-algorithm" class="md-nav__link">
    <span class="md-ellipsis">Example Algorithm</span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#forward-over-adjoint" class="md-nav__link">
    <span class="md-ellipsis">Forward Over Adjoint</span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#other-second-order-modes" class="md-nav__link">
    <span class="md-ellipsis">Other Second-<wbr>Order Modes</span>
  </a>
  
    <nav class="md-nav" aria-label="Other Second-Order Modes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#forward-over-forward" class="md-nav__link">
    <span class="md-ellipsis">Forward Over Forward</span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#adjoint-over-forward" class="md-nav__link">
    <span class="md-ellipsis">Adjoint Over Forward</span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#adjoint-over-adjoint" class="md-nav__link">
    <span class="md-ellipsis">Adjoint Over Adjoint</span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset" role="main">
                


  <h1 id="higher-order-derivatives"><span id="higher-order"></span>Higher-Order Derivatives<a class="headerlink" href="#higher-order-derivatives" title="Permalink to this heading">¶</a></h1>
<p>As explained in <a class="reference internal" href="aad.html#aad-higher"><span class="std std-ref">Higher Orders</span></a>, higher order derivatives can be computed
by nesting first order algorithmic differentiation techniques.
For example, one can obtain second order by computing forward mode over adjoint mode.
With XAD,
this technique can be used directly to compute higher order derivatives.</p>
<p>XAD’s automatic differentiation interface structures (see <a class="reference internal" href="ref/interface.html#ref-interface"><span class="std std-ref">AD Mode Interface</span></a>)
define second order mode data types for easy access.
Types for third or higher orders need to defined manually
from the basic first-order types.</p>
<p>We will demonstrate second-order derivatives using forward-over-adjoint mode
in the following.</p>
<h2 id="example-algorithm">Example Algorithm<a class="headerlink" href="#example-algorithm" title="Permalink to this heading">¶</a></h2>
<p>For demonstration purposes, we use the same algorithm from <a class="reference internal" href="basic.html#tutorial"><span class="std std-ref">Basic Usage</span></a>:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><code><span class="k">template</span><span class="w"> </span><span class="o">&lt;</span><span class="k">class</span><span class="w"> </span><span class="nc">T</span><span class="o">&gt;</span><span class="w"></span>
<span class="n">T</span><span class="w"> </span><span class="n">f</span><span class="p">(</span><span class="n">T</span><span class="w"> </span><span class="n">x0</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="w"> </span><span class="n">x1</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="w"> </span><span class="n">x2</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="w"> </span><span class="n">x3</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="n">T</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sin</span><span class="p">(</span><span class="n">x0</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">cos</span><span class="p">(</span><span class="n">x1</span><span class="p">);</span><span class="w"></span>
<span class="w">  </span><span class="n">T</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">x3</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">tan</span><span class="p">(</span><span class="n">x1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">x2</span><span class="p">);</span><span class="w"></span>
<span class="w">  </span><span class="n">T</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">2</span><span class="o">*</span><span class="w"> </span><span class="n">b</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">c</span><span class="o">*</span><span class="n">c</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>
</div>
<p>We are interested in derivatives at the point:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><code><span class="kt">double</span><span class="w"> </span><span class="n">x0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.0</span><span class="p">;</span><span class="w"></span>
<span class="kt">double</span><span class="w"> </span><span class="n">x1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.5</span><span class="p">;</span><span class="w"></span>
<span class="kt">double</span><span class="w"> </span><span class="n">x2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.3</span><span class="p">;</span><span class="w"></span>
<span class="kt">double</span><span class="w"> </span><span class="n">x3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.2</span><span class="p">;</span><span class="w"></span>
</code></pre></div>
</div>
<h2 id="forward-over-adjoint">Forward Over Adjoint<a class="headerlink" href="#forward-over-adjoint" title="Permalink to this heading">¶</a></h2>
<p>In this mode, we can compute all first-order derivatives (as a single output
function derived with adjoints gives all first order derivatives),
and the first row of the Hessian matrix of second order derivatives.
The full Hessian is defined as:</p>
<div class="math">
<p><img src="_images/math/34a1f2851a2959ee29de7b900784b99350baf8ba.svg" alt="\Large
\bm H = \left[ \begin{array}{cccc}
  \frac{\partial^2 f}{\partial x_0^2} &amp;
  \frac{\partial^2 f}{\partial x_0 \partial x_1} &amp;
  \frac{\partial^2 f}{\partial x_0 \partial x_2} &amp;
  \frac{\partial^2 f}{\partial x_0 \partial x_3} \\[6pt]
  \frac{\partial^2 f}{\partial x_1 \partial x_0} &amp;
  \frac{\partial^2 f}{\partial x_1^2} &amp;
  \frac{\partial^2 f}{\partial x_1 \partial x_2} &amp;
  \frac{\partial^2 f}{\partial x_1 \partial x_3} \\[6pt]
  \frac{\partial^2 f}{\partial x_2 \partial x_0} &amp;
  \frac{\partial^2 f}{\partial x_2 \partial x_1} &amp;
  \frac{\partial^2 f}{\partial x_2^2} &amp;
  \frac{\partial^2 f}{\partial x_2 \partial x_3} \\[6pt]
  \frac{\partial^2 f}{\partial x_3 \partial x_0} &amp;
  \frac{\partial^2 f}{\partial x_3 \partial x_1} &amp;
  \frac{\partial^2 f}{\partial x_3 \partial x_2} &amp;
  \frac{\partial^2 f}{\partial x_3^2}
\end{array}\right]"/></p>
</div><p>Note that the Hessian matrix is typically symmetric,
which can be used to reduce the amount of computation needed for the full Hessian.</p>
<p>The first step is to set up the tape and active data types needed for this computation:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><code><span class="k">typedef</span><span class="w"> </span><span class="n">xad</span><span class="o">::</span><span class="n">fwd_adj</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="w"> </span><span class="n">mode</span><span class="p">;</span><span class="w"></span>
<span class="k">typedef</span><span class="w"> </span><span class="n">mode</span><span class="o">::</span><span class="n">tape_type</span><span class="w"> </span><span class="n">tape_type</span><span class="p">;</span><span class="w"></span>
<span class="k">typedef</span><span class="w"> </span><span class="n">mode</span><span class="o">::</span><span class="n">active_type</span><span class="w"> </span><span class="n">AD</span><span class="p">;</span><span class="w"></span>

<span class="n">tape_type</span><span class="w"> </span><span class="n">tape</span><span class="p">;</span><span class="w"></span>
</code></pre></div>
</div>
<p>Note that the active type for this mode is actually <code class="docutils literal notranslate"><span class="pre">AReal&lt;FReal&lt;double&gt;</span> <span class="pre">&gt;</span></code>.</p>
<p>Now we need to setup the independent variables and register them:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><code><span class="n">AD</span><span class="w"> </span><span class="n">x0_ad</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x0</span><span class="p">;</span><span class="w"></span>
<span class="n">AD</span><span class="w"> </span><span class="n">x1_ad</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x1</span><span class="p">;</span><span class="w"></span>
<span class="n">AD</span><span class="w"> </span><span class="n">x2_ad</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x2</span><span class="p">;</span><span class="w"></span>
<span class="n">AD</span><span class="w"> </span><span class="n">x3_ad</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x3</span><span class="p">;</span><span class="w"></span>

<span class="n">tape</span><span class="p">.</span><span class="n">registerInput</span><span class="p">(</span><span class="n">x0_ad</span><span class="p">);</span><span class="w"></span>
<span class="n">tape</span><span class="p">.</span><span class="n">registerInput</span><span class="p">(</span><span class="n">x1_ad</span><span class="p">);</span><span class="w"></span>
<span class="n">tape</span><span class="p">.</span><span class="n">registerInput</span><span class="p">(</span><span class="n">x2_ad</span><span class="p">);</span><span class="w"></span>
<span class="n">tape</span><span class="p">.</span><span class="n">registerInput</span><span class="p">(</span><span class="n">x3_ad</span><span class="p">);</span><span class="w"></span>
</code></pre></div>
</div>
<p>As we compute the second order using forward mode,
we need to seed the initial derivative for the second order before running the algorithm:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><code><span class="n">derivative</span><span class="p">(</span><span class="n">value</span><span class="p">(</span><span class="n">x0_ad</span><span class="p">))</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.0</span><span class="p">;</span><span class="w"></span>
</code></pre></div>
</div>
<p>The inner call to <a class="reference internal" href="ref/complex.html#_CPPv4I0E5valueNSt7complexI1TEERKNSt7complexI5ARealI1TEEE" title="value (C++ function) — Returns the value of the z variable (underlying double type), represented as a complex number."><code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">value()</span></code></a> takes the value of the outer type,
i.e. it returns the value as the type <code class="docutils literal notranslate"><span class="pre">FReal&lt;double&gt;</span></code>,
of which we set the derivative to <code class="docutils literal notranslate"><span class="pre">1</span></code>.</p>
<p>Now we can start recording derivatives on the tape and run the algorithm:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><code><span class="n">tape</span><span class="p">.</span><span class="n">newRecording</span><span class="p">();</span><span class="w"></span>

<span class="n">AD</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">f</span><span class="p">(</span><span class="n">x0_ad</span><span class="p">,</span><span class="w"> </span><span class="n">x1_ad</span><span class="p">,</span><span class="w"> </span><span class="n">x2_ad</span><span class="p">,</span><span class="w"> </span><span class="n">x3_ad</span><span class="p">);</span><span class="w"></span>
</code></pre></div>
</div>
<p>For the inner adjoint mode, we need to register the output and seed the initial adjoint with 1:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><code><span class="n">tape</span><span class="p">.</span><span class="n">registerOutput</span><span class="p">(</span><span class="n">y</span><span class="p">);</span><span class="w"></span>
<span class="n">value</span><span class="p">(</span><span class="n">derivative</span><span class="p">(</span><span class="n">y</span><span class="p">))</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.0</span><span class="p">;</span><span class="w"></span>
</code></pre></div>
</div>
<p>Here, the inner call to <a class="reference internal" href="ref/complex.html#_CPPv4I0E10derivativeNSt7complexI1TEERKNSt7complexI5ARealI1TEEE" title="derivative (C++ function) — Returns the adjoints of the z variable, represented as a complex number of the underlying double type."><code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">derivative()</span></code></a> gives the derivative of the outer
type, i.e. the derivative of the adjoint-mode active type.
This is of type <code class="docutils literal notranslate"><span class="pre">FReal&lt;double&gt;</span></code>, for which we set the value to <code class="docutils literal notranslate"><span class="pre">1</span></code>.</p>
<p>Next we compute the adjoints, which computes both the first and second order
derivatives:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><code><span class="n">tape</span><span class="p">.</span><span class="n">computeAdjoints</span><span class="p">();</span><span class="w"></span>
</code></pre></div>
</div>
<p>We can now output the result:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><code><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;y = &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">value</span><span class="p">(</span><span class="n">value</span><span class="p">(</span><span class="n">y</span><span class="p">))</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span><span class="w"></span>
</code></pre></div>
</div>
<p>And the first order derivatives:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><code><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;dy/dx0 = &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">value</span><span class="p">(</span><span class="n">derivative</span><span class="p">(</span><span class="n">x0_ad</span><span class="p">))</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="w"></span>
<span class="w">          </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;dy/dx1 = &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">value</span><span class="p">(</span><span class="n">derivative</span><span class="p">(</span><span class="n">x1_ad</span><span class="p">))</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="w"></span>
<span class="w">          </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;dy/dx2 = &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">value</span><span class="p">(</span><span class="n">derivative</span><span class="p">(</span><span class="n">x2_ad</span><span class="p">))</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="w"></span>
<span class="w">          </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;dy/dx3 = &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">value</span><span class="p">(</span><span class="n">derivative</span><span class="p">(</span><span class="n">x3_ad</span><span class="p">))</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span><span class="w"></span>
</code></pre></div>
</div>
<p>Note again that the inner call to <a class="reference internal" href="ref/complex.html#_CPPv4I0E10derivativeNSt7complexI1TEERKNSt7complexI5ARealI1TEEE" title="derivative (C++ function) — Returns the adjoints of the z variable, represented as a complex number of the underlying double type."><code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">derivative()</span></code></a> obtains the derivative
of the outer active data type,
hence it gives a <code class="docutils literal notranslate"><span class="pre">FReal&lt;double&gt;</span></code> reference that represents the first order adjoint value.
We can get this value as a <code class="docutils literal notranslate"><span class="pre">double</span></code> using the <a class="reference internal" href="ref/complex.html#_CPPv4I0E5valueNSt7complexI1TEERKNSt7complexI5ARealI1TEEE" title="value (C++ function) — Returns the value of the z variable (underlying double type), represented as a complex number."><code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">value()</span></code></a> call.</p>
<p>The second order derivatives w.r.t. <code class="docutils literal notranslate"><span class="pre">x0</span></code> can be obtained as:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><code><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;d2y/dx0dx0 = &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">derivative</span><span class="p">(</span><span class="n">derivative</span><span class="p">(</span><span class="n">x0_ad</span><span class="p">))</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="w"></span>
<span class="w">          </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;d2y/dx0dx1 = &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">derivative</span><span class="p">(</span><span class="n">derivative</span><span class="p">(</span><span class="n">x1_ad</span><span class="p">))</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="w"></span>
<span class="w">          </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;d2y/dx0dx2 = &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">derivative</span><span class="p">(</span><span class="n">derivative</span><span class="p">(</span><span class="n">x2_ad</span><span class="p">))</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="w"></span>
<span class="w">          </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;d2y/dx0dx3 = &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">derivative</span><span class="p">(</span><span class="n">derivative</span><span class="p">(</span><span class="n">x3_ad</span><span class="p">))</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span><span class="w"></span>
</code></pre></div>
</div>
<p>which ‘unwraps’ the derivatives of the first and second order active types.</p>
<p>The result of the running the application for the given inputs is:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span><code>y      = 7.69565
dy/dx0 = 0.21205
dy/dx1 = -16.2093
dy/dx2 = 24.8681
dy/dx3 = 14.4253
d2y/dx0dx0 = -0.327326
d2y/dx0dx1 = -3.21352
d2y/dx0dx2 = 0.342613
d2y/dx0dx3 = 0.198741
</code></pre></div>
</div>
<p>Forward over adjoint is the recommended mode for second-order derivatives.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p>This example is included with XAD (<a class="reference external" href="https://github.com/xcelerit/XAD/tree/main/samples/fwd_adj_2nd">fwd_adj_2nd</a>).</p>
</div>
<h2 id="other-second-order-modes">Other Second-Order Modes<a class="headerlink" href="#other-second-order-modes" title="Permalink to this heading">¶</a></h2>
<p>Other second-order modes work in a similar fashion.
They are briefly described in the following.</p>
<h3 id="forward-over-forward">Forward Over Forward<a class="headerlink" href="#forward-over-forward" title="Permalink to this heading">¶</a></h3>
<p>With forward-over-forward mode,
there is no tape needed and the derivatives of both orders need to be seeded
before running the algorithm.
One element of the Hessian and one first-order derivative can be computed
with this method, if the function has one output.
The derivative initialization sequence in this mode is typically:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><code><span class="n">value</span><span class="p">(</span><span class="n">derivative</span><span class="p">(</span><span class="n">x</span><span class="p">))</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.0</span><span class="p">;</span><span class="w">   </span><span class="c1">// initialize the first-order derivative</span>
<span class="n">derivative</span><span class="p">(</span><span class="n">value</span><span class="p">(</span><span class="n">x</span><span class="p">))</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.0</span><span class="p">;</span><span class="w">   </span><span class="c1">// initialize the second-order derivative</span>
</code></pre></div>
</div>
<p>After the computation, the first order derivative can be retrieved as:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><code><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;dy/dx = &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">derivative</span><span class="p">(</span><span class="n">value</span><span class="p">(</span><span class="n">y</span><span class="p">))</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span><span class="w"></span>
</code></pre></div>
</div>
<p>And the second order derivative as:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><code><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;d2y/dxdx = &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">derivative</span><span class="p">(</span><span class="n">derivative</span><span class="p">(</span><span class="n">y</span><span class="p">))</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span><span class="w"></span>
</code></pre></div>
</div>
<p>With different initial seeding, different elements of the Hessian can be obtained.</p>
<h3 id="adjoint-over-forward">Adjoint Over Forward<a class="headerlink" href="#adjoint-over-forward" title="Permalink to this heading">¶</a></h3>
<p>Here the inner mode is forward,
computing one derivative in a tape-less fashion,
and the outer mode is adjoint, requiring a tape.
With this mode, we need to initialize the forward-mode derivative with:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><code><span class="n">value</span><span class="p">(</span><span class="n">derivative</span><span class="p">(</span><span class="n">x</span><span class="p">))</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.0</span><span class="p">;</span><span class="w">   </span><span class="c1">// initialize the first-order derivative</span>
</code></pre></div>
</div>
<p>As the derivative of the output corresponds to the first order result,
we need to seed its derivative (i.e. the adjoint) after running the algorithm:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><code><span class="n">derivative</span><span class="p">(</span><span class="n">derivative</span><span class="p">(</span><span class="n">y</span><span class="p">))</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.0</span><span class="p">;</span><span class="w"></span>
</code></pre></div>
</div>
<p>After tape interpretation, we can now obtain the first-order derivative as:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><code><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;dy/dx = &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">value</span><span class="p">(</span><span class="n">derivative</span><span class="p">(</span><span class="n">y</span><span class="p">))</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span><span class="w"></span>
</code></pre></div>
</div>
<p>Due to the symmetries in this mode of operation, the same first-order derivatives
can also be obtained as:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><code><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;dy/dx = &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">derivative</span><span class="p">(</span><span class="n">derivative</span><span class="p">(</span><span class="n">x</span><span class="p">))</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span><span class="w"></span>
</code></pre></div>
</div>
<p>Which allows to get all first-order derivatives w.r.t. to all inputs in this mode,
similar to the forward-over-adjoint mode.</p>
<p>The second-order derivatives can be obtained as:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><code><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;d2y/dxdx = &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">derivative</span><span class="p">(</span><span class="n">value</span><span class="p">(</span><span class="n">x</span><span class="p">))</span><span class="w"></span>
</code></pre></div>
</div>
<h3 id="adjoint-over-adjoint">Adjoint Over Adjoint<a class="headerlink" href="#adjoint-over-adjoint" title="Permalink to this heading">¶</a></h3>
<p>As both nested modes are adjoint,
this mode needs to two tapes for both orders.
Hence the types defined in the interface structure <a class="desctype reference internal" href="ref/interface.html#_CPPv4I0E7adj_adj" title="adj_adj (C++ class) — Structure defining the data types for second order adjoint-over-adjoint mode."><code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">adj_adj</span></code></a>
need an inner and an outer tape type:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><code><span class="k">typedef</span><span class="w"> </span><span class="n">xad</span><span class="o">::</span><span class="n">adj_adj</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="w"> </span><span class="n">mode</span><span class="p">;</span><span class="w"></span>
<span class="k">typedef</span><span class="w"> </span><span class="n">mode</span><span class="o">::</span><span class="n">inner_tape_type</span><span class="w"> </span><span class="n">inner_tape_type</span><span class="p">;</span><span class="w"></span>
<span class="k">typedef</span><span class="w"> </span><span class="n">mode</span><span class="o">::</span><span class="n">outer_tape_type</span><span class="w"> </span><span class="n">outer_tape_type</span><span class="p">;</span><span class="w"></span>
<span class="k">typedef</span><span class="w"> </span><span class="n">mode</span><span class="o">::</span><span class="n">active_type</span><span class="w"> </span><span class="n">AD</span><span class="p">;</span><span class="w"></span>
</code></pre></div>
</div>
<p>In this mode, no initial derivatives need to be set,
but it is important that both tapes are initialized and a new recording is
started on both before running the algorithm.</p>
<p>After the execution, the outer derivative needs to be seeded as:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><code><span class="n">value</span><span class="p">(</span><span class="n">derivative</span><span class="p">(</span><span class="n">y</span><span class="p">))</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.0</span><span class="p">;</span><span class="w"></span>
</code></pre></div>
</div>
<p>And then the outer tape needs to compute the adjoints.
This computes the <code class="docutils literal notranslate"><span class="pre">value(derivative(x))</span></code> as an output,
and the derivative of this needs to be set before interpreting the inner tape:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><code><span class="n">derivative</span><span class="p">(</span><span class="n">derivative</span><span class="p">(</span><span class="n">x</span><span class="p">))</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.0</span><span class="p">;</span><span class="w"></span>
</code></pre></div>
</div>
<p>After calling <code class="docutils literal notranslate"><span class="pre">computeAdjoints()</span></code> on the inner tape,
we can read the first-order derivatives as:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><code><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;dy/dx = &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">value</span><span class="p">(</span><span class="n">derivative</span><span class="p">(</span><span class="n">x</span><span class="p">))</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;</span><span class="se">\n</span><span class="s">;</span>
</code></pre></div>
</div>
<p>And the second-order derivatives as:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><code><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;d2y/dxdx&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">derivative</span><span class="p">(</span><span class="n">value</span><span class="p">(</span><span class="n">x</span><span class="p">))</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span><span class="w"></span>
</code></pre></div>
</div>



  <hr>
<div class="md-source-file">
  <small>
    
      Last update:
      September  2022
    
  </small>
</div>

              
            </article>
          </div>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        
        <a href="checkpointing.html" class="md-footer__link md-footer__link--prev" aria-label="Previous: Checkpointing" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Checkpointing
            </div>
          </div>
        </a>
      
      
        
        <a href="smoothed_math.html" class="md-footer__link md-footer__link--next" aria-label="Next: Handling Discontinuities" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Handling Discontinuities
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
          </div>
        </a>
      
    </nav>
  
  
  
  <div class="md-footer-meta md-typeset">
    
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-footer-copyright__highlight">
        &#169; Copyright 2010-2022, Xcelerit Computing Ltd.
        
    </div>
  
  
</div>
      
    </div>
    
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": ".", "features": ["toc.follow", "navigation.sections", "navigation.tracking", "search.highlight", "search.share"], "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script>
    
    
      <script src="_static/javascripts/bundle.dc1bded0.min.js"></script>
    
  </body>
</html>